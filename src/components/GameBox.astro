---
const { game } = Astro.props;
const frontCover = "/game-images/" + game.data.shortName + "/front-cover.jpg";
const backCover = "/game-images/" + game.data.shortName + "/back-cover.jpg";
---

<script>
    import * as THREE from "three";
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    let cube: THREE.Mesh;
    let renderer: THREE.WebGLRenderer;
    let scene: THREE.Scene;
    let camera: THREE.PerspectiveCamera;
    let controls: OrbitControls;

    init();
    animate();

    function init() {
        const frontCoverNode = document.getElementById(
            "front-cover"
        ) as HTMLInputElement;
        const backCoverNode = document.getElementById(
            "back-cover"
        ) as HTMLInputElement;

        const canvas = document.getElementById("game-box-3d") as HTMLElement;
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(
            90,
            canvas.offsetWidth / 500,
            1,
            1000
        );

        renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(canvas.offsetWidth, 500);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.update();

        canvas.appendChild(renderer.domElement);

        const textureFront = new THREE.TextureLoader().load(
            frontCoverNode.value
        );
        const textureBack = new THREE.TextureLoader().load(backCoverNode.value);
        const textureLeft = new THREE.TextureLoader().load(
            "/game-images/standard-textures/left-cover.jpg"
        );
        const textureBlack = new THREE.TextureLoader().load(
            "/game-images/standard-textures/black-cover.jpg"
        );
        const materialFront = new THREE.MeshBasicMaterial({
            map: textureFront,
        });
        const materialBack = new THREE.MeshBasicMaterial({ map: textureBack });
        const materialLeft = new THREE.MeshBasicMaterial({ map: textureLeft });
        const materialBlack = new THREE.MeshBasicMaterial({
            map: textureBlack,
        });

        const geometry = new THREE.BoxGeometry(13.7, 17.7, 2.5);
        cube = new THREE.Mesh(geometry, [
            materialBlack,
            materialLeft,
            materialBlack,
            materialBlack,
            materialFront,
            materialBack,
        ]);
        scene.add(cube);

        camera.position.x = 2;
        camera.position.y = 1;
        camera.position.z = 17;
        camera.lookAt(1, 0.2, 1);
    }

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
        controls.update();
    }
</script>
<style></style>
<div id="game-box-3d">
    <input id="front-cover" value={frontCover} class="d-none" />
    <input id="back-cover" value={backCover} class="d-none" />
</div>
